/**
 * Router
 * Petr Nevyhoštěný
 * MIT (c) 2013
 */
!function(a){var b=function(){var a=function(a,b){var c=a.split("/").slice(1),d={};c.forEach(function(a,c){d.wildcard=/^\:.+$/.test(a),d.star=/^\*$/.test(a),d.optional=/^.+\?/.test(a),b(a,d,c)})},b=function(b){var c="^";return a(b,function(a,b){c+=b.optional?"(?:[/](?=[^/]+)":"/",c+=b.wildcard?"([^/]+)":b.star?"[^/]+":a,b.optional&&(c+=")?")}),c+="$",new RegExp(c)},c=function(b){var c=[];return a(b,function(a,b){b.wildcard&&c.push(a.replace(/\:|\?/g,""))}),c};return{getRegExp:b,getParams:c}}(),c=function(a){var b=[],c=function(){f()},d=function(){location.hash=location.hash||"/",a.addEventListener("hashchange",c,!1)},e=function(){a.removeEventListener("hashchange",c),b=[]},f=function(){b.forEach(function(a){a(location.hash.substring(1))})},g=function(a){b.push(a)},h=function(b){a.location.hash=b};return{init:d,stop:e,listen:g,go:h}}(a),d=function(a){var b="",c=[],d=function(){i()},e=function(c){b=c,a.addEventListener("popstate",d,!1)},f=function(){a.removeEventListener("popstate",d),b="",c=[]},g=function(a){return("/"+b+"/"+a).replace("//","/")},h=function(a){return a.replace(b,"").replace("//","/")},i=function(){c.forEach(function(a){a(h(location.pathname.replace(b,"")))})},j=function(a){return!(!a.history||!a.history.pushState)}(a),k=function(a){c.push(a)},l=function(b){a.history.pushState(null,"",g(b)),i()};return{init:e,stop:f,isSupported:j,listen:k,go:l}}(a),e=function(a,b){return a.isSupported?a:b}(d,c),f=function(a,b,c,d){this.location=a||"",this.title=b||"",this.state=c||{},this.params=d||{}},g=function(){var a={},b=function(b,c){a[b]=c},c=function(b,c){"undefined"!=typeof a[b]&&a[b](c)};return{add:b,trigger:c}}(),h=[],i="",j=/^@.+$/,k=function(a){var c,d,i,e={},j=!1;h.forEach(function(g){c=b.getRegExp(g.definition),c.test(a)&&(j=!0,d=b.getParams(g.definition),d.forEach(function(b,d){e[b]=a.replace(c,"$"+(d+1))}),i=new f(a,"",{},e),Object.freeze(i),g.callback(i))}),j||(i=new f(a,"",{},e),Object.freeze(i),g.trigger("404",i))},l=function(a,b){return"function"==typeof a?(g.add("404",a),void 0):j.test(a)?(g.add(a.substring(1),b),void 0):(h.push({definition:a,callback:b}),void 0)},m=function(a,b){return j.test(a)?(g.trigger(a.substring(1),b),void 0):(e.go(a),void 0)},n=function(a){i=a,e.init(i)},o=function(){e.stop(),e=void 0===e.isSupported?d:c,e.init(i),e.listen(k)};a.router={route:l,go:m,base:n,switchProvider:o},a.setTimeout(function(){e.init(i),e.listen(k)},0)}(window);